<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apprendre le Cyrillique (Cartes & Quiz)</title>
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Configuration des polices et du th√®me sombre global (Style Apple) */
        :root {
            font-family: 'Inter', sans-serif;
        }

        /* Styles sp√©cifiques pour les cartes 3D */
        .flip-card-container {
            perspective: 1000px;
            height: 100%;
            width: 100%;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4); /* Ombre plus marqu√©e pour le mode sombre */
            border-radius: 0.75rem; 
        }

        .flip-card-container.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem;
            padding: 1rem;
        }
        
        /* COULEURS DARK MODE POUR LE FRONT DE LA CARTE */
        .flip-card-front {
            background-color: #1f2937; /* bg-gray-800 */
            color: #d1d5db; /* text-gray-300 */
            font-size: 5rem;
            font-weight: 700;
            border: 1px solid #4b5563; /* Bordure subtile */
            cursor: pointer;
            user-select: none;
        }
        
        @media (max-width: 640px) {
             .flip-card-front {
                font-size: 4rem; 
            }
        }

        /* COULEURS DARK MODE POUR LE DOS DE LA CARTE */
        .flip-card-back {
            background-color: #374151; /* bg-gray-700 */
            color: #f3f4f6; /* text-gray-50 */
            transform: rotateY(180deg);
            border: 1px solid #4b5563;
            cursor: pointer;
            text-align: center; /* Centrer le contenu du dos */
            padding: 1.5rem;
            overflow-y: auto; 
            position: relative; /* N√©cessaire pour positionner le bouton audio */
        }

        /* Ajustements de style pour le dos de la carte */
        .cyrillic-char {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #60a5fa; /* Bleu clair d'accent */
        }

        .latin-transcription {
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981; /* Vert d'accent */
        }

        .pronunciation-hint {
            font-size: 1rem;
            color: #9ca3af; /* Gris clair */
            margin-top: 0.5rem;
            line-height: 1.4;
            font-style: italic;
        }

        /* Styles sp√©cifiques au Quiz */
        .quiz-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
        }
        .option-button {
            transition: all 0.2s;
            border: 1px solid #4b5563;
        }
        /* Couleurs pour les boutons de r√©ponse en mode sombre */
        .correct {
            background-color: #059669 !important; /* bg-emerald-600 */
            color: white !important;
            animation: pulse-correct 0.5s 2;
        }
        .incorrect {
            background-color: #dc2626 !important; /* bg-red-600 */
            color: white !important;
            animation: shake 0.5s;
        }
        @keyframes pulse-correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Styles pour le bouton Audio */
        .audio-btn {
            background-color: #3b82f6; /* bg-blue-500 */
            color: white;
            padding: 0.5rem;
            border-radius: 9999px;
            transition: background-color 0.2s;
            z-index: 10;
            flex-shrink: 0;
        }
        .audio-btn:hover:not(:disabled) {
            background-color: #2563eb; /* bg-blue-600 */
        }
        .audio-btn:disabled {
            background-color: #6b7280; /* bg-gray-500 */
            cursor: not-allowed;
        }

        .card-audio-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }

        @media (min-width: 640px) {
            .vocab-item {
                flex-wrap: nowrap;
            }
        }
    </style>
</head>
<!-- COULEURS DARK MODE POUR LE BODY -->
<body class="bg-gray-900 min-h-screen p-4 sm:p-8 text-gray-100 flex flex-col items-center">
    
    <!-- En-t√™te (Am√©lior√©) -->
    <header class="text-center mb-12 w-full max-w-4xl">
        <h1 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold mb-4 
                   bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-teal-400 
                   drop-shadow-lg leading-tight">
            üáßüá¨ Ma√Ætriser l'Alphabet Cyrillique Bulgare
        </h1>
        <p class="text-xl text-gray-400 font-medium tracking-wide">
            √âtude par cartes flash et auto-√©valuation par quiz.
        </p>
        <!-- Ligne d√©corative -->
        <div class="h-1 w-24 mx-auto bg-blue-500/50 rounded-full mt-6"></div>
    </header>

    <!-- 1. SECTION CARTES FLASH (Encadr√©e) -->
    <section class="mb-16 w-full max-w-7xl bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-700 shadow-lg">
        <h2 class="text-3xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-2 flex justify-between items-center">
            <span>1. Cartes Flash (R√©vision)</span>
            <button 
                id="reset-cards-btn" 
                class="text-sm font-semibold px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition duration-150 shadow-md transform hover:scale-105"
                onclick="resetAllCardsToCyrillic()"
            >
                Montrer l'Alphabet
            </button>
        </h2>
        <!-- Zone d'affichage des cartes -->
        <div id="card-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4 mx-auto">
            <!-- Les cartes seront ins√©r√©es ici par JavaScript -->
        </div>
        
        <div id="stats" class="text-center mt-6 text-xl font-semibold text-gray-400">
            <!-- Les statistiques seront affich√©es ici -->
        </div>
    </section>

    <!-- 2. SECTION QUIZ (Encadr√©e) -->
    <section class="w-full max-w-xl mb-16 bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-700 shadow-lg">
        <h2 class="text-3xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-2">2. Quiz d'Auto-√âvaluation</h2>
        
        <div id="quiz-header" class="text-center mb-6">
            <p id="question-counter" class="text-xl font-medium text-teal-400">Pr√™t √† commencer ?</p>
        </div>

        <div id="quiz-container" class="w-full bg-gray-900 rounded-xl p-6 md:p-10 quiz-card flex flex-col justify-between">
            <div class="text-center">
                 <button 
                    class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-xl transform hover:scale-105"
                    onclick="initQuiz()"
                >
                    D√©marrer le Quiz de 10 Questions
                </button>
            </div>
            <!-- Question, Options, et R√©sultats seront ins√©r√©s ici par JS apr√®s le d√©marrage -->
        </div>
    </section>
    
    <!-- 3. SECTION VOCABULAIRE ESSENTIEL (Encadr√©e) -->
    <section class="w-full max-w-xl mb-16 bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-700 shadow-lg">
        <h2 class="text-3xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-2">3. Vocabulaire Essentiel</h2>
        <div id="vocabulary-list" class="bg-gray-900 rounded-xl p-6 md:p-8 shadow-inner">
            <!-- Vocabulaire ins√©r√© ici par JS -->
        </div>
    </section>
    
    <!-- 4. PANNEAU DE D√âBOGAGE AUDIO (Am√©lior√©) -->
    <footer class="w-full max-w-4xl bg-gray-800 rounded-xl p-4 sm:p-6 border border-gray-700 shadow-xl mb-8">
        <h3 class="text-xl font-bold text-gray-200 mb-3">üõ†Ô∏è Test Audio Natif (D√©pannage)</h3>
        <p class="text-sm text-gray-400 mb-4">
            Cette application utilise le moteur de synth√®se vocale natif de votre navigateur. La qualit√© de la prononciation bulgare (`bg-BG`) d√©pend fortement de la voix install√©e sur votre syst√®me. Si l'audio est m√©diocre ou absent, veuillez tester avec la voix fran√ßaise ci-dessous.
        </p>
        <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button 
                id="test-native-audio-btn" 
                class="w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-full transition duration-150 shadow-lg"
                onclick="testNativeAudioFallback()"
                title="Testez si la synth√®se vocale de votre navigateur fonctionne en Fran√ßais"
            >
                Tester la voix en Fran√ßais (fr-FR)
            </button>
            <p id="audio-status" class="text-sm font-medium text-gray-300">Statut : Pr√™t</p>
        </div>
    </footer>


    <!-- Script JavaScript (logique combin√©e) -->
    <script>
        // --- Fonctions utilitaires Audio (Simplifi√©es) ---

        /**
         * G√®re le processus de lecture de texte complet via le moteur natif du navigateur.
         * @param {string} text Le texte √† lire.
         * @param {HTMLElement} button Le bouton qui a d√©clench√© l'action.
         * @param {string} langCode Le code langue √† utiliser (par d√©faut 'bg-BG').
         */
        function speakText(text, button, langCode = 'bg-BG') {
            if (!('speechSynthesis' in window)) {
                console.error("Synth√®se vocale native non support√©e par ce navigateur.");
                return;
            }

            const originalContent = button.innerHTML;
            
            // 1. Annuler toute parole pr√©c√©dente
            window.speechSynthesis.cancel(); 

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = langCode; 
            utterance.pitch = 1;
            utterance.rate = 1;
            
            // 2. Disable & show loading
            button.disabled = true;
            button.innerHTML = '<svg class="animate-spin w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            
            // 3. Setup cleanup (important for unreliable onend)
            let timer;
            const cleanup = () => {
                button.disabled = false;
                button.innerHTML = originalContent;
                clearInterval(timer); // S'assurer que le timer est nettoy√©
                if (timer) {
                    timer = null;
                }
            };

            // 4. Fallback check for onend failure (check if speaking stops after a brief period)
            // This ensures the button is re-enabled even if onend doesn't fire.
            timer = setInterval(() => {
                if (!window.speechSynthesis.speaking) {
                    cleanup();
                }
            }, 500); // V√©rifie toutes les 500ms

            // 5. Native event handlers
            utterance.onend = cleanup;
            utterance.onerror = (event) => {
                console.error(`Erreur de parole native en ${langCode}: `, event);
                cleanup();
            };
            
            // 6. Speak
            window.speechSynthesis.speak(utterance);
            console.log(`Tentative de lecture native du texte en ${langCode}: "${text.substring(0, 30)}..."`);
        }
        
        /**
         * Fonction de test sp√©cifique pour le panneau de d√©bogage (utilise fr-FR).
         */
        function testNativeAudioFallback() {
            const button = document.getElementById('test-native-audio-btn');
            const statusDiv = document.getElementById('audio-status');
            const originalText = button.textContent;
            
            if (!('speechSynthesis' in window)) {
                statusDiv.textContent = "Statut : ‚ùå √âchec. La synth√®se vocale native est indisponible.";
                statusDiv.classList.remove('text-gray-300');
                statusDiv.classList.add('text-red-400');
                return;
            }

            // Pr√©paration de la parole
            window.speechSynthesis.cancel();
            const text = "Ceci est un test pour v√©rifier si la synth√®se vocale de votre navigateur fonctionne.";
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR'; 

            statusDiv.textContent = "Statut : Test en cours (Fran√ßais)...";
            button.disabled = true;
            
            const resetStatus = (success) => {
                button.disabled = false;
                button.textContent = originalText;
                
                if (success) {
                    statusDiv.textContent = "Statut : ‚úÖ Succ√®s ! Le moteur natif fonctionne.";
                    statusDiv.classList.remove('text-gray-300', 'text-red-400');
                    statusDiv.classList.add('text-teal-400');
                } else {
                    statusDiv.textContent = "Statut : ‚ùå √âchec. Veuillez v√©rifier vos param√®tres audio.";
                    statusDiv.classList.remove('text-gray-300', 'text-teal-400');
                    statusDiv.classList.add('text-red-400');
                }

                setTimeout(() => {
                    statusDiv.textContent = "Statut : Pr√™t";
                    statusDiv.classList.remove('text-teal-400', 'text-red-400');
                    statusDiv.classList.add('text-gray-300');
                }, 5000);
            };

            utterance.onend = () => resetStatus(true);
            utterance.onerror = (e) => resetStatus(false);
            
            window.speechSynthesis.speak(utterance);
            
            // Fallback pour les navigateurs avec un onend peu fiable
            setTimeout(() => {
                if (window.speechSynthesis.speaking) {
                    // Si toujours en cours apr√®s 8s (long), on le laisse finir son job
                } else if (button.disabled) {
                    // Si onend/onerror n'a pas √©t√© d√©clench√©
                    resetStatus(true); 
                }
            }, 8000);
        }

        // --- DATA (Alphabet Cyrillique Bulgare - 30 lettres) ---
        const alphabet = [
            { cyr: '–ê –∞', lat: 'A', pron: 'Comme dans "arbre" (toujours ouvert)' },
            { cyr: '–ë –±', lat: 'B', pron: 'Comme dans "balle"' },
            { cyr: '–í –≤', lat: 'V', pron: 'Comme dans "voiture"' },
            { cyr: '–ì –≥', lat: 'G', pron: 'Comme dans "gar√ßon"' },
            { cyr: '–î –¥', lat: 'D', pron: 'Comme dans "domino"' },
            { cyr: '–ï –µ', lat: '√â', pron: 'Comme dans "√©t√©" (jamais "ye" ou "i√©")' }, // Sp√©cificit√© bulgare
            { cyr: '–ñ –∂', lat: 'J', pron: 'Comme dans "jupe"' },
            { cyr: '–ó –∑', lat: 'Z', pron: 'Comme dans "z√®bre"' },
            { cyr: '–ò –∏', lat: 'I', pron: 'Comme dans "√Æle"' },
            { cyr: '–ô –π', lat: 'Y (bref)', pron: 'Comme dans pa"ys" (bref)' },
            { cyr: '–ö –∫', lat: 'K', pron: 'Comme dans "kilo"' },
            { cyr: '–õ –ª', lat: 'L', pron: 'Comme dans "lit"' },
            { cyr: '–ú –º', lat: 'M', pron: 'Comme dans "maman"' },
            { cyr: '–ù –Ω', lat: 'N', pron: 'Comme dans "nez"' },
            { cyr: '–û –æ', lat: 'O', pron: 'Comme dans "orange" (toujours ouvert)' },
            { cyr: '–ü –ø', lat: 'P', pron: 'Comme dans "pied"' },
            { cyr: '–† —Ä', lat: 'R', pron: 'Roul√© (mais moins fort qu\'en russe)' },
            { cyr: '–° —Å', lat: 'S', pron: 'Comme dans "soleil"' },
            { cyr: '–¢ —Ç', lat: 'T', pron: 'Comme dans "taxi"' },
            { cyr: '–£ —É', lat: 'Ou', pron: 'Comme dans "ours"' },
            { cyr: '–§ —Ñ', lat: 'F', pron: 'Comme dans "fleur"' },
            { cyr: '–• —Ö', lat: 'H', pron: 'Son guttural (comme le "j" espagnol)' },
            { cyr: '–¶ —Ü', lat: 'Ts', pron: 'Comme dans "tsar"' },
            { cyr: '–ß —á', lat: 'Tch', pron: 'Comme dans "tch√®que"' },
            { cyr: '–® —à', lat: 'Ch', pron: 'Comme dans "chat"' },
            { cyr: '–© —â', lat: 'Sht', pron: 'Comme "cht" dans "post-scriptum"' }, // Sp√©cificit√© bulgare
            { cyr: '–™ —ä', lat: 'A (dur)', pron: 'Voyelle tr√®s ferm√©e, comme le "a" dans "the" en anglais' }, // Sp√©cificit√© bulgare
            { cyr: '–¨ —å', lat: 'Y (mou)', pron: 'Seulement utilis√© avant O pour le son "yo"' }, // Sp√©cificit√© bulgare
            { cyr: '–Æ —é', lat: 'You', pron: 'Comme dans "yougourt"' },
            { cyr: '–Ø —è', lat: 'Ya', pron: 'Comme dans "yacht"' },
        ];
        
        // --- DATA (Vocabulaire de base) ---
        const vocabulary = [
            { bulgarian: '–ó–¥—Ä–∞–≤–µ–π', french: 'Bonjour (informel)', pronunciation: '(zdra-v√®√Ø)' },
            { bulgarian: '–î–æ–±—ä—Ä –¥–µ–Ω', french: 'Bonjour (formel/journ√©e)', pronunciation: '(d√≥-bar d√®n)' },
            { bulgarian: '–õ–µ–∫–∞ –Ω–æ—â', french: 'Bonne nuit', pronunciation: '(l√®-ka nocht)' },
            { bulgarian: '–î–æ–≤–∏–∂–¥–∞–Ω–µ', french: 'Au revoir', pronunciation: '(do-v√≠zh-da-n√©)' },
            { bulgarian: '–ú–æ–ª—è', french: 'S‚Äôil vous pla√Æt / Je vous en prie', pronunciation: '(m√≥-lya)' },
            { bulgarian: '–ë–ª–∞–≥–æ–¥–∞—Ä—è', french: 'Merci', pronunciation: '(bla-go-da-ry√†)' },
            { bulgarian: '–î–∞', french: 'Oui', pronunciation: '(da)' },
            { bulgarian: '–ù–µ', french: 'Non', pronunciation: '(n√©)' },
            { bulgarian: '–ò–∑–≤–∏–Ω–µ—Ç–µ', french: 'Excusez-moi / Pardon', pronunciation: '(iz-vi-n√©-t√©)' },
            { bulgarian: '–ö–∞–∫ —Å–∏?', french: 'Comment √ßa va ? (informel)', pronunciation: '(kak si)' },
            { bulgarian: '–î–æ–±—Ä–µ', french: 'Bien', pronunciation: '(do-br√©)' },
            { bulgarian: '–õ–æ—à–æ', french: 'Mal', pronunciation: '(lo-cho)' },
            { bulgarian: '–í–æ–¥–∞', french: 'Eau', pronunciation: '(v√¥-da)' },
            { bulgarian: '–•–ª—è–±', french: 'Pain', pronunciation: '(hlyap)' },
            { bulgarian: '–ê–∑ —Å—ä–º...', french: 'Je suis...', pronunciation: '(az sam)' },
            { bulgarian: '–ö–æ–ª–∫–æ —Å—Ç—Ä—É–≤–∞?', french: 'Combien √ßa co√ªte ?', pronunciation: '(k√≥l-ko str√∫-va)' },
            { bulgarian: '–ü–æ–º–æ—â!', french: '√Ä l\'aide !', pronunciation: '(p√≥-mocht)' },
            // Nombres 1-10
            { bulgarian: '–ï–¥–Ω–æ', french: '1 (Un)', pronunciation: '(e-n√≥)' },
            { bulgarian: '–î–≤–µ', french: '2 (Deux)', pronunciation: '(dv√©)' },
            { bulgarian: '–¢—Ä–∏', french: '3 (Trois)', pronunciation: '(tri)' },
            { bulgarian: '–ß–µ—Ç–∏—Ä–∏', french: '4 (Quatre)', pronunciation: '(ch√©-ti-ri)' },
            { bulgarian: '–ü–µ—Ç', french: '5 (Cinq)', pronunciation: '(pet)' },
            { bulgarian: '–®–µ—Å—Ç', french: '6 (Six)', pronunciation: '(chesht)' },
            { bulgarian: '–°–µ–¥–µ–º', french: '7 (Sept)', pronunciation: '(s√©-dem)' },
            { bulgarian: '–û—Å–µ–º', french: '8 (Huit)', pronunciation: '(√≥-sem)' },
            { bulgarian: '–î–µ–≤–µ—Ç', french: '9 (Neuf)', pronunciation: '(d√©-vet)' },
            { bulgarian: '–î–µ—Å–µ—Ç', french: '10 (Dix)', pronunciation: '(d√©-set)' }
        ];

        // --- √âL√âMENTS DU DOM ---
        const cardGrid = document.getElementById('card-grid');
        const statsDisplay = document.getElementById('stats');
        const quizContainer = document.getElementById('quiz-container');
        const questionCounter = document.getElementById('question-counter');
        const vocabularyListDiv = document.getElementById('vocabulary-list');

        // --- √âTAT GLOBAL ---
        let flippedCards = 0;

        // --- √âTAT DU QUIZ ---
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestions = 10;
        const quizQuestions = [];
        let currentQuestion = null;
        let isAnswerLocked = false;


        // ===================================
        // LOGIQUE DES CARTES FLASH
        // ===================================

        /**
         * Fonction pour cr√©er le HTML d'une carte
         */
        function createCardHtml(data) {
            // cyrillicLetter prend la majuscule pour l'affichage de face
            const cyrillicLetter = data.cyr.split(' ')[0]; 
            const fullCyrillic = data.cyr; 
            
            // Texte √† prononcer : la lettre cyrillique
            const textToSpeak = fullCyrillic;

            return `
                <div class="flip-card-container h-48 sm:h-56" onclick="flipCard(this)">
                    <div class="flip-card-inner">
                        <!-- C√¥t√© Cyrillique (Face) -->
                        <div class="flip-card-front">
                            ${cyrillicLetter}
                        </div>
                        
                        <!-- C√¥t√© Latin et Prononciation (Dos) -->
                        <div class="flip-card-back flex justify-center items-center p-4">
                            <!-- Bouton Audio -->
                            <button 
                                class="audio-btn card-audio-btn" 
                                onclick="event.stopPropagation(); speakText('${textToSpeak.replace(/'/g, "\\'")}', this);"
                                title="√âcouter la prononciation"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V9a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0111 3v18a1 1 0 01-1.707.707L5.586 15z"></path>
                                </svg>
                            </button>
                            <!-- Contenu de la carte -->
                            <div class="w-full text-center">
                                <div class="cyrillic-char font-bold text-4xl">${fullCyrillic}</div>
                                <div class="latin-transcription text-xl mt-2">‚Üí ${data.lat}</div>
                                <p class="pronunciation-hint text-base mt-4">(${data.pron})</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Fonction pour basculer une carte
         */
        function flipCard(cardContainer) {
            const isFlipped = cardContainer.classList.contains('flipped');
            cardContainer.classList.toggle('flipped');

            if (isFlipped) {
                flippedCards--;
            } else {
                flippedCards++;
            }
            updateStats();
        }
        
        /**
         * Fonction pour retourner toutes les cartes vers le c√¥t√© cyrillique (face avant).
         */
        function resetAllCardsToCyrillic() {
            const allCards = document.querySelectorAll('.flip-card-container');
            allCards.forEach(card => {
                // Seulement retirer la classe 'flipped' si elle est pr√©sente
                if (card.classList.contains('flipped')) {
                    card.classList.remove('flipped');
                }
            });
            // R√©initialiser l'√©tat des cartes retourn√©es
            flippedCards = 0;
            updateStats();
        }

        /**
         * Fonction pour mettre √† jour l'affichage des statistiques
         */
        function updateStats() {
            statsDisplay.innerHTML = `
                ${flippedCards} / ${alphabet.length} lettres explor√©es 
                <span class="text-sm font-normal text-gray-500">(Cliquez √† nouveau pour les masquer)</span>
            `;
        }


        // ===================================
        // LOGIQUE DU QUIZ
        // ===================================

        /**
         * M√©lange un tableau (Algorithme de Fisher-Yates)
         */
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * G√©n√®re un tableau de questions al√©atoires.
         */
        function generateQuizQuestions() {
            // Version simplifi√©e de l'alphabet pour la logique du quiz (prend seulement la majuscule)
            // Filtre les lettres non pertinentes pour le QCM simple (e.g., les signes mous/durs)
            const simpleAlphabet = alphabet.map(l => ({ 
                cyr: l.cyr.split(' ')[0], 
                lat: l.lat 
            })).filter(l => l.cyr !== '–™' && l.cyr !== '–¨');

            // S√©lectionne 10 lettres al√©atoires sans r√©p√©tition
            const selectedLetters = shuffle([...simpleAlphabet]).slice(0, totalQuestions);
            
            quizQuestions.length = 0; // R√©initialise les questions

            selectedLetters.forEach(correctLetter => {
                const distractors = [];
                // S'assure que les mauvaises r√©ponses sont diff√©rentes
                const availableDistractors = simpleAlphabet.filter(l => l.lat !== correctLetter.lat);
                const randomDistractors = shuffle(availableDistractors).slice(0, 3);
                
                randomDistractors.forEach(d => distractors.push(d.lat));

                const options = shuffle([...distractors, correctLetter.lat]);

                quizQuestions.push({
                    cyrillic: correctLetter.cyr,
                    correctAnswer: correctLetter.lat,
                    options: options
                });
            });
        }
        
        /**
         * D√©marre/R√©initialise l'√©tat du quiz
         */
        function initQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            isAnswerLocked = false;
            generateQuizQuestions();
            displayQuestion();
        }


        /**
         * Affiche la question actuelle dans l'interface utilisateur.
         */
        function displayQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            isAnswerLocked = false;
            currentQuestion = quizQuestions[currentQuestionIndex];

            // Mise √† jour du compteur
            questionCounter.textContent = `Question ${currentQuestionIndex + 1} / ${totalQuestions}`;

            // Contenu HTML de la question
            quizContainer.innerHTML = `
                <div class="text-center mb-8">
                    <p class="text-xl font-semibold text-gray-300 mb-4">
                        Quelle est la transcription latine de cette lettre ?
                    </p>
                    <div class="text-9xl font-extrabold text-blue-400 p-6 bg-gray-900 rounded-xl inline-block shadow-lg select-none">
                        ${currentQuestion.cyrillic}
                    </div>
                </div>

                <div id="options-grid" class="grid grid-cols-2 gap-4">
                    ${currentQuestion.options.map((option, index) => `
                        <button
                            class="option-button bg-gray-700 hover:bg-gray-600 text-gray-100 font-bold py-3 px-4 rounded-xl text-lg shadow-md"
                            onclick="checkAnswer('${option}', this)"
                            data-option="${option}"
                        >
                            ${option}
                        </button>
                    `).join('')}
                </div>
                
                <div id="feedback" class="text-center mt-6 text-xl font-bold"></div>
            `;
        }

        /**
         * V√©rifie la r√©ponse de l'utilisateur.
         */
        function checkAnswer(selectedAnswer, button) {
            if (isAnswerLocked) return;
            isAnswerLocked = true;
            
            const feedbackDiv = document.getElementById('feedback');
            const allButtons = document.querySelectorAll('.option-button');

            const isCorrect = selectedAnswer === currentQuestion.correctAnswer;
            
            if (isCorrect) {
                score++;
                button.classList.add('correct');
                feedbackDiv.textContent = "‚úÖ Correct !";
                feedbackDiv.classList.add('text-teal-400');
            } else {
                button.classList.add('incorrect');
                feedbackDiv.textContent = `‚ùå Faux. C'est : ${currentQuestion.correctAnswer}`;
                feedbackDiv.classList.add('text-red-400');
            }

            // Mettre en √©vidence la bonne r√©ponse
            allButtons.forEach(btn => {
                btn.disabled = true; // D√©sactiver tous les boutons
                if (btn.dataset.option === currentQuestion.correctAnswer && !isCorrect) {
                    btn.classList.add('correct');
                }
            });

            // Passer √† la question suivante apr√®s un court d√©lai
            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
            }, 1500);
        }

        /**
         * Affiche les r√©sultats finaux du quiz.
         */
        function showResults() {
            questionCounter.textContent = "Quiz Termin√© !";
            const percentage = Math.round((score / totalQuestions) * 100);
            
            quizContainer.innerHTML = `
                <div class="text-center flex flex-col justify-center items-center h-full py-10">
                    <h2 class="text-4xl font-extrabold text-blue-400 mb-4">R√©sultats du Quiz</h2>
                    <p class="text-6xl font-black text-teal-400 mb-6">${score} / ${totalQuestions}</p>
                    <p class="text-2xl font-semibold text-gray-300 mb-6">${percentage}% de bonnes r√©ponses.</p>
                    
                    <button 
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full transition duration-300 shadow-lg mt-4 transform hover:scale-105"
                        onclick="initQuiz()"
                    >
                        Recommencer le Quiz
                    </button>
                </div>
            `;
        }
        
        // ===================================
        // LOGIQUE DU VOCABULAIRE
        // ===================================
        
        /**
         * Affiche la liste du vocabulaire essentiel.
         */
        function displayVocabulary() {
            let html = '';

            vocabulary.forEach(item => {
                const textToSpeak = item.bulgarian;

                // Structure mise √† jour pour inclure le bouton Audio 
                html += `
                    <div class="flex justify-between items-center py-3 border-b border-gray-700 last:border-b-0 flex-wrap vocab-item">
                        <div class="flex flex-col w-full sm:w-auto sm:flex-row sm:items-center mb-2 sm:mb-0">
                            <div class="text-xl font-bold text-blue-400 sm:mr-4">${item.bulgarian}</div>
                            <div class="text-md text-gray-400 italic font-medium mt-1 sm:mt-0">${item.pronunciation}</div>
                        </div>
                        <div class="flex items-center space-x-4 w-full sm:w-auto justify-between sm:justify-end">
                            <div class="text-lg text-gray-300">${item.french}</div>
                            <button 
                                class="audio-btn" 
                                onclick="event.stopPropagation(); speakText('${textToSpeak.replace(/'/g, "\\'")}', this);"
                                title="√âcouter le mot"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.899a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1V9a1 1 0 011-1h1.586l4.707-4.707A1 1 0 0111 3v18a1 1 0 01-1.707.707L5.586 15z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            });

            vocabularyListDiv.innerHTML = html;
        }

        // --- INITIALISATION GLOBALE ---
        function initializeApp() {
            // 1. Initialiser les cartes
            let allCardsHtml = '';
            alphabet.forEach(letter => {
                allCardsHtml += createCardHtml(letter);
            });
            cardGrid.innerHTML = allCardsHtml;
            updateStats(); 

            // 2. Afficher le vocabulaire
            displayVocabulary();
        }

        window.onload = initializeApp;
        
        // Rendre les fonctions globales disponibles pour le HTML
        window.flipCard = flipCard;
        window.initQuiz = initQuiz;
        window.checkAnswer = checkAnswer;
        window.resetAllCardsToCyrillic = resetAllCardsToCyrillic;
        window.speakText = speakText;
        window.testNativeAudioFallback = testNativeAudioFallback;
    </script>
</body>
</html>
